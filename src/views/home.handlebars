<section>
  {{#if user}}
  <h1>Welcome back, {{user.username}}!</h1>
  <p>Your account is set. Next up: incidents, comments, votes, and trends.</p>
  {{else}}
  <h1>Welcome</h1>
  <p>Sign in to get started.</p>
  <p><a href="/auth/login">Login</a> or <a href="/auth/register">Create an account</a>.</p>
  {{/if}}
</section>

<hr />

<section>
  <h2>Search 311 Incidents by ZIP</h2>

  <form action="/feed" method="POST" class="zip-form">
    <label for="zip">Enter ZIP Code:</label>
    <input type="text" id="zip" name="zip" value="{{zip}}" placeholder="e.g., 10001" required />

    <button type="submit">Search</button>

    {{#if error}}
    <p class="error">{{error}}</p>
    {{/if}}
  </form>
</section>

{{#if zip}}
<hr />
<section>
  <h2>Recent Incidents for ZIP {{zip}}</h2>

  <section class="quick-filters">
    <h3>Quick Filters</h3>
    <form action="/feed" method="GET">
      <input type="hidden" name="zip" value="{{zip}}">
      <input type="hidden" name="page" value="1">

      <label>
        Status:
        <select name="status">
          <option value="">All</option>
          <option value="Open" {{#if (eq status "Open" )}}selected{{/if}}>Open</option>
          <option value="Closed" {{#if (eq status "Closed" )}}selected{{/if}}>Closed</option>
        </select>
      </label>

      <label>
        Complaint Type:
        <input type="text" name="complaintType" placeholder="e.g. Noise" value="{{complaintType}}">
      </label>

      <label>
        Agency:
        <input type="text" name="agency" placeholder="e.g. NYPD" value="{{agency}}">
      </label>

      <label>
        Sort By:
        <select name="sort">
          <option value="">Newest</option>
          <option value="oldest" {{#if (eq sort "oldest" )}}selected{{/if}}>
            Oldest
          </option>
        </select>
      </label>

      <button type="submit">Apply Filters</button>
    </form>
  </section>

  {{#if incidents.length}}
  <ul class="incident-list">
    {{#each incidents}}
    <li class="incident-item">
      <strong>{{this.complaintType}}</strong><br />
      {{this.descriptor}}<br />
      <em>{{this.createdDate}}</em><br />
      Status: {{this.status}}<br />

      <a href="/incident/{{this.openDataId}}?zip={{../zip}}&page={{../page}}">View Details</a>
    </li>
    {{/each}}
  </ul>

  {{!-- page --}}
  <div class="pagination">
    {{#if page}}

    {{#if (gt page 1)}}
    <form action="/feed" method="GET" style="display:inline;">
      <input type="hidden" name="zip" value="{{zip}}">
      <input type="hidden" name="page" value="{{decrement page}}">
      <input type="hidden" name="status" value="{{status}}">
      <input type="hidden" name="complaintType" value="{{complaintType}}">
      <input type="hidden" name="agency" value="{{agency}}">
      <input type="hidden" name="sort" value="{{sort}}">
      <button type="submit">Previous</button>
    </form>
    {{/if}}

    <span>Page {{page}}</span>

    {{#if hasNextPage}}
    <form action="/feed" method="GET" style="display:inline;">
      <input type="hidden" name="zip" value="{{zip}}">
      <input type="hidden" name="page" value="{{increment page}}">
      <input type="hidden" name="status" value="{{status}}">
      <input type="hidden" name="complaintType" value="{{complaintType}}">
      <input type="hidden" name="agency" value="{{agency}}">
      <input type="hidden" name="sort" value="{{sort}}">
      <button type="submit">Next</button>
    </form>
    {{/if}}

    {{/if}}
  </div>

  {{else}}
  <p>No incidents found for this ZIP in the last 30 days.</p>
  {{/if}}
</section>
{{/if}}