<section>
    <h1>Incident Details</h1>

    <p>
        <a href="/feed?zip={{zip}}&page={{page}}">‚Üê Back to Feed</a>
    </p>
</section>

<hr />

<section>
    <h2>{{incident.complaintType}}</h2>

    {{#if incident.descriptor}}
    <p><strong>Description:</strong> {{incident.descriptor}}</p>
    {{/if}}

    <p><strong>Status:</strong> {{incident.status}}</p>

    {{#if incident.agency}}
    <p><strong>Agency:</strong> {{incident.agency}}</p>
    {{/if}}

    {{#if incident.incidentZip}}
    <p><strong>ZIP Code:</strong> {{incident.incidentZip}}</p>
    {{/if}}

    {{#if incident.createdDate}}
    <p><strong>Created:</strong> {{incident.createdDate}}</p>
    {{/if}}
</section>

<hr />

<section>
    <h3>Location</h3>

    {{#if incident.latitude}}
    {{#if incident.longitude}}
    <div id="map" data-lat="{{incident.latitude}}" data-lng="{{incident.longitude}}"
        data-complaint="{{incident.complaintType}}" data-desc="{{incident.descriptor}}" style="height:400px;">
    </div>
    {{else}}
    <p>No location data available.</p>
    {{/if}}
    {{else}}
    <p>No location data available.</p>
    {{/if}}
</section>

<hr />

<section>
    <h3>Comments</h3>

    {{#if user}}
    <form action="/incident/{{incident.openDataId}}/comment" method="POST">
        <input type="hidden" name="zip" value="{{zip}}">
        <input type="hidden" name="page" value="{{page}}">
        <textarea name="content" rows="3" required></textarea><br />
        <button type="submit">Post Comment</button>
    </form>
    {{else}}
    <p><a href="/auth/login">Login</a> to post a comment.</p>
    {{/if}}

    {{#if comments.length}}
    <ul class="comment-list">
        {{#each comments}}
        <li id="comment-{{this._id}}" data-user-id="{{../user.id}}">
            <strong>{{this.username}}</strong><br />
            {{this.content}}<br />
            <small>{{this.createdAt}}</small>

            <p>
                <span id="likeCount-{{this._id}}">Likes: </span>
                <button class="voteButton" id="likeButton-{{this._id}}" data-comment-id="{{this._id}}" data-type="like" data-incident-id="{{incident.openDataId}}">{{this.likes.length}}</button>

                <span id="dislikeCount-{{this._id}}">Dislikes: </span>
                <button class="voteButton" id="dislikeButton-{{this._id}}" data-comment-id="{{this._id}}" data-type="dislike" data-incident-id="{{incident.openDataId}}">{{this.dislikes.length}}</button>
            </p>

            
        </li>
        {{/each}}
    </ul>
    {{else}}
    <p>No comments yet.</p>
    {{/if}}
</section>
<script src="/public/js/incidentMap.js"></script>
<script src="/js/jquery.min.js"></script>
<script src="/public/js/comments.js"></script>